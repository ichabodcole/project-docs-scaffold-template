# Migration: v2.3 → v2.4

## Summary

v2.4 adds the **Test Plan** document type — an optional stage between Plan and
Sessions that defines tiered verification scenarios for agent-implemented work.
It also adds an **External Dependencies** subsection to the Design Resolution
template.

**Why this changed:** Agent-implemented features were being declared "complete"
without structured verification, leading to manual testing loops. The test plan
closes this gap by giving implementing agents a concrete verification roadmap
with prioritized scenarios. The external dependencies addition ensures
third-party setup requirements (API keys, accounts, environment variables) are
surfaced early rather than discovered during testing.

## What's New

| File/Directory                             | Purpose                          |
| ------------------------------------------ | -------------------------------- |
| `projects/TEMPLATES/TEST-PLAN.template.md` | Template for test plan documents |

## What Changed

| File/Directory                                     | Change                                  |
| -------------------------------------------------- | --------------------------------------- |
| `projects/TEMPLATES/DESIGN-RESOLUTION.template.md` | Added External Dependencies subsection  |
| `projects/README.md`                               | Added Test Plans section                |
| `docs/README.md`                                   | Updated lifecycle, flowchart, reference |

## What's Removed

Nothing is removed in this migration.

## Step-by-Step Migration

### 1. Generate v2.4 scaffold locally

```bash
cookiecutter gh:ichabodcole/project-docs-scaffold-template -o .scaffold-tmp
```

### 2. Copy new template

```bash
SCAFFOLD=".scaffold-tmp/<project-name>/docs"

# Copy new template
cp "$SCAFFOLD/projects/TEMPLATES/TEST-PLAN.template.md" \
   docs/projects/TEMPLATES/TEST-PLAN.template.md
```

### 3. Update Design Resolution template

The design resolution template gains an "External Dependencies (Optional)"
subsection under Architectural Positioning. Replace your copy:

```bash
cp "$SCAFFOLD/projects/TEMPLATES/DESIGN-RESOLUTION.template.md" \
   docs/projects/TEMPLATES/DESIGN-RESOLUTION.template.md
```

Or manually add the subsection after the Architectural Positioning bullets. See
the scaffold copy for the exact content.

### 4. Update docs/projects/README.md

Replace your `docs/projects/README.md` with the scaffold's version:

```bash
cp "$SCAFFOLD/projects/README.md" docs/projects/README.md
```

Key additions:

- `test-plan.md` in the project folder structure example (marked optional)
- A "What Goes Where" entry for `test-plan.md`
- A "Test Plans" subsection with when-to/when-not-to guidance and tier
  descriptions
- `TEST-PLAN.template.md` in the Templates list

If you've customized your `projects/README.md`, merge the new sections manually
instead of overwriting.

### 5. Update docs/README.md

**5a. Decision flowchart** — Add an optional "Need structured verification?"
decision diamond between "Add plan.md to project" and "Working on it?"

**5b. Documentation cycle** — Update the pipeline string:

```
# Before
Report → Investigation → Project (proposal → [design-resolution] → plan → sessions) → Report

# After
Report → Investigation → Project (proposal → [design-resolution] → plan → [test-plan] → sessions) → Report
```

**5c. Quick Reference** — Update the Project entry to mention test plan:

```markdown
- **Project:** "Here's the full story of building X — proposal, design
  resolution (optional), plan, test plan (optional), sessions, artifacts in one
  place."
```

**5d. Special cases** — Add:

```markdown
- **Need structured verification for agent-implemented features?** → Test plan
  after planning
```

**5e. Update version** — Update the `docs_version` frontmatter to match the
target version.

### 6. Clean up scaffold

```bash
rm -rf .scaffold-tmp
```

## Verification

```bash
# New template should exist
ls docs/projects/TEMPLATES/TEST-PLAN.template.md

# Design resolution template should reference external dependencies
grep "External Dependencies" docs/projects/TEMPLATES/DESIGN-RESOLUTION.template.md

# projects/README.md should reference test plans
grep "test-plan" docs/projects/README.md

# docs/README.md should reference test plan in the cycle
grep "test-plan" docs/README.md

# Version marker should be updated
grep "docs_version" docs/README.md
```

## Checklist

- [ ] Generated v2.4 scaffold locally via cookiecutter
- [ ] Copied `TEST-PLAN.template.md` to `projects/TEMPLATES/`
- [ ] Updated `DESIGN-RESOLUTION.template.md` with External Dependencies
      subsection
- [ ] Updated `docs/projects/README.md` with test plan sections
- [ ] Updated `docs/README.md` decision flowchart
- [ ] Updated `docs/README.md` documentation cycle string
- [ ] Updated `docs/README.md` Quick Reference and Special cases
- [ ] Updated `docs_version` frontmatter
- [ ] Removed `.scaffold-tmp/` directory
- [ ] Verified new template and references exist
