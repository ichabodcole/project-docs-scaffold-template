# Test Plan Document Type — Implementation Plan

**Created:** 2026-02-15\
**Related Proposal:** [Test Plan Proposal](./proposal.md)\
**Design Resolution:** [Design Resolution](./design-resolution.md)\
**Status:** Draft

---

## Overview

This plan implements a new optional document type — the test plan — along with
its supporting agent, skill, command, and template. The work follows the same
pattern established by the design-resolution doc type: a template in the project
templates folder, a dedicated agent, a skill with methodology, a user-facing
command, and documentation updates across the scaffold.

The design resolution locks in key decisions: the document is named
`test-plan.md`, uses a three-tier priority system, is generated by a dedicated
agent that produces scenarios only (no code, no execution), and results are
recorded as an addendum by the implementing agent. Screenshots go in
`docs/projects/<name>/artifacts/screenshots/`.

## Outcome & Success Criteria

**Definition of Done:**

- [ ] `TEST-PLAN.template.md` exists in both cookiecutter and project templates
- [ ] `test-plan-generator` agent exists in plugin agents
- [ ] `generate-test-plan` skill exists with full methodology
- [ ] `/project-docs:generate-test-plan` command is user-invocable
- [ ] WORKTREE_TASK.md template references test-plan.md
- [ ] finalize-branch command checks for test plan results when test-plan.md
      exists
- [ ] Documentation updated: docs/README.md, docs/projects/README.md,
      docs/PROJECT_MANIFESTO.md
- [ ] Plugin version bumped with version history entry
- [ ] Manifesto counts updated (14 commands, 18 skills, 8 agents)
- [ ] Migration guide created for update-project-docs skill
- [ ] All files pass Prettier formatting

**Non-Goals:**

- Automated test execution infrastructure
- CI/CD integration
- Visual regression comparison tooling
- Changes to the plan template's "Testing & Validation Strategy" section

## Approach Summary

Follow the design-resolution implementation pattern: template first (establishes
the document format), then agent (defines the generator's personality and
constraints), then skill (detailed methodology), then command (user-facing entry
point), then integration updates (worktree template, finalize-branch), then
documentation (README, manifesto, flowchart, migration guide).

The cookiecutter template is the source of truth for mirrored files. Updates go
there first, then mirror to the project's own `docs/`.

### Current State → Proposed State

| Component         | Current                             | After                                             |
| ----------------- | ----------------------------------- | ------------------------------------------------- |
| Project templates | 4 (proposal, DR, plan, handoff)     | 5 (+test-plan)                                    |
| Plugin agents     | 7                                   | 8 (+test-plan-generator)                          |
| Plugin skills     | 17                                  | 18 (+generate-test-plan)                          |
| Plugin commands   | 13                                  | 14 (+generate-test-plan)                          |
| Plugin version    | 1.3.0                               | 1.4.0                                             |
| Lifecycle string  | `proposal → [DR] → plan → sessions` | `proposal → [DR] → plan → [test-plan] → sessions` |

## Phases

### Phase 1: Template

**Goal:** Establish the test plan document format.

**Key Changes:**

- Create
  `{{cookiecutter.project_slug}}/docs/projects/TEMPLATES/TEST-PLAN.template.md`
- Mirror to `docs/projects/TEMPLATES/TEST-PLAN.template.md`

**Template sections** (from design resolution):

1. Overview — what's being verified, link to plan and proposal
2. Test Environment — how to start the app, prerequisites, URLs, external
   dependencies (services, API keys, env vars, human actions required),
   verification command to confirm prerequisites are met
3. Verification Scenarios — organized by tier:
   - Tier 1 (Smoke): app builds, pages render, no console errors
   - Tier 2 (Critical Path): core user flows, key unit tests
   - Tier 3 (Edge Cases / Backlog): deferred with rationale
   - Each scenario has: ID (e.g., `T2-01`), title, type (UI/E2E, Unit,
     Integration, Manual), priority, source (which proposal goal or plan phase),
     steps, expected result
4. Out of Scope / Backlog — explicitly deferred tests with rationale
5. Results Addendum (filled during/after execution) — pass/fail/blocked per
   scenario, failure notes, screenshot references
6. Visual Artifacts — links to screenshots in
   `docs/projects/<name>/artifacts/screenshots/`

**Design decisions to apply:**

- Screenshot naming: scenario-based (`T2-01-create-document.png`) — ties
  screenshots to scenarios for traceability
- Results format: markdown table at the bottom — scannable, easy for
  finalize-branch to check for existence

**Validation:**

- [ ] Template passes Prettier
- [ ] Both copies (cookiecutter + project) are identical
- [ ] Template comment block explains when to use/skip

**Dependencies:** None.

---

### Phase 2: Agent

**Goal:** Create the test plan generation agent.

**Key Changes:**

- Create `plugins/project-docs/agents/test-plan-generator.md`

**Agent design** (from design resolution — generates only, no execution):

- Follow the pattern of existing agents (e.g., `dev-plan-generator.md`,
  `proposal-writer.md`)
- Frontmatter: name, description (with trigger phrases), model, tools
- Agent persona: Testing & Quality Specialist grounded in 80/20 philosophy
- Instructions: read plan + proposal + DR, identify testable surfaces, apply
  tiered prioritization, output `test-plan.md` using the template
- Keep agent instructions concise — the skill provides detailed methodology
- The agent should identify external dependencies / prerequisites from the plan
  and surface them in the Test Environment section

**Validation:**

- [ ] Agent frontmatter follows plugin conventions
- [ ] Description includes concrete trigger phrases
- [ ] Instructions are concise (methodology lives in skill)

**Dependencies:** Phase 1 (template must exist for agent to reference).

---

### Phase 3: Skill + Command

**Goal:** Create the user-facing workflow for generating test plans.

**Key Changes:**

- Create `plugins/project-docs/skills/generate-test-plan/SKILL.md`
- Create `plugins/project-docs/commands/generate-test-plan.md`

**Skill design** (follow proposal-to-design-resolution pattern):

- Purpose section with philosophy (80/20 rule, tiered prioritization, test what
  matters not everything)
- Process phases:
  1. Read & analyze plan — read plan, proposal, DR if present; identify testable
     surfaces from plan phases and proposal goals; gate check (if plan's testing
     section is already comprehensive with concrete scenarios, suggest skipping)
  2. Identify scenarios — extract from plan phase validation sections, proposal
     goals, risk areas, user-facing flows, integration points
  3. Tier and prioritize — apply Tier 1/2/3 system; Tier 1 from app-level smoke
     checks, Tier 2 from proposal goals and plan phases, Tier 3 from edge cases
     and complex mocking scenarios
  4. Identify prerequisites — check plan dependencies for external services, API
     keys, environment setup; surface human actions required
  5. Write test plan — output to `docs/projects/$1/test-plan.md` using template
  6. Present & refine — show to user, apply feedback, suggest next step
     (implementation)
- Important guidelines: convergence not creation (don't invent new
  requirements), the anti-pattern is testing everything, explicitly defer Tier 3
  items
- Allowed tools: `["Read", "Write", "Grep", "Glob"]`

**Command design** (follow proposal-to-design-resolution command pattern):

- Condensed workflow that references the skill's methodology
- Same allowed tools
- Accepts project name as argument: `/project-docs:generate-test-plan <name>`

**Validation:**

- [ ] Skill follows established structure (frontmatter, purpose, philosophy,
      process, output, guidelines)
- [ ] Command frontmatter matches skill
- [ ] Gate check exists (don't force test plans on work that doesn't need them)

**Dependencies:** Phase 1 (template), Phase 2 (agent).

---

### Phase 4: Integration Updates

**Goal:** Wire the test plan into existing workflows.

**Key Changes:**

- Update
  `plugins/project-docs/skills/parallel-worktree-dev/scripts/templates/WORKTREE_TASK.template.md`
  — add test-plan.md to Source Documents
- Update `plugins/project-docs/commands/finalize-branch.md` — add soft check for
  test plan results

**WORKTREE_TASK.md update:**

Add under Source Documents, after the Plan line:

```markdown
- [Test Plan](docs/projects/<project-name>/test-plan.md) (if applicable)
```

**finalize-branch update:**

Add to the "Documentation" section in Claude-Specific Guidance:

- Test plan: If `docs/projects/<project-name>/test-plan.md` exists, verify that
  a results addendum section is present with pass/fail/blocked statuses. Flag
  any Tier 1 or Tier 2 scenarios without results. This is a soft check — don't
  block the merge, but surface it to the user during the review.

**Validation:**

- [ ] WORKTREE_TASK.md template lists test-plan.md in source documents
- [ ] finalize-branch mentions test plan check in documentation section
- [ ] No existing functionality is broken

**Dependencies:** Phases 1-3 complete (so references are valid).

---

### Phase 5: Documentation + Plugin Updates

**Goal:** Update all cross-references, counts, and lifecycle descriptions.

**Key Changes:**

Documentation (cookiecutter-first for mirrored files):

- `{{cookiecutter.project_slug}}/docs/projects/README.md` — add "Test Plans"
  section (parallel to existing "Design Resolutions" section): when to write,
  when to skip, relationship to plan template, three-tier system
- `{{cookiecutter.project_slug}}/docs/README.md` — update lifecycle string to
  include `[test-plan]`, update decision flowchart
- Mirror both to project's own `docs/`
- `docs/PROJECT_MANIFESTO.md` — update pipeline references (grep for `→ plan →`
  and stage names), update counts to 14 commands, 18 skills, 8 agents

Plugin:

- `plugins/project-docs/.claude-plugin/plugin.json` — bump version to 1.4.0
- `plugins/project-docs/README.md` — add version history entry, add command
  documentation for `/project-docs:generate-test-plan`

Migration:

- Create
  `plugins/project-docs/skills/update-project-docs/migrations/v2.3-to-v2.4.md` —
  guide for adding `TEST-PLAN.template.md` to existing projects
- Update migration table in
  `plugins/project-docs/skills/update-project-docs/skill.md`

**Validation:**

- [ ] Lifecycle strings are consistent across all docs
- [ ] Manifesto counts match actual `ls | wc -l` results
- [ ] Cookiecutter and project copies are identical for mirrored files
- [ ] Migration guide exists and migration table is updated
- [ ] Plugin version and history entry are present
- [ ] All files pass Prettier

**Dependencies:** Phases 1-4 complete (so all components exist to reference).

## Key Risks & Mitigations

- **Consistency across touchpoints** — The lifecycle string appears in multiple
  files (README, projects README, manifesto). Missing one creates inconsistency.
  → Run the scaffold-update-checklist skill before finalizing.
- **Template becomes too prescriptive** — The test plan template could feel like
  ceremony for simple features. → Template comment block explicitly says when to
  skip; skill includes a gate check.
- **Agent persona drift** — The test plan agent's 80/20 philosophy is important
  but could get diluted if the instructions are too long. → Keep agent concise,
  detailed methodology lives in the skill.

## Testing & Validation Strategy

This is a documentation and plugin tooling change with no application code. The
validation approach is:

- Prettier formatting passes on all new and modified markdown files
- Cookiecutter template copies match project copies (verified with `diff`)
- Skill and agent counts match manifesto claims (verified with `ls | wc -l`)
- Scaffold-update-checklist skill confirms all cross-references are consistent

## Assumptions & Constraints

- The design resolution template's External Dependencies subsection and the
  proposal-to-design-resolution skill's external dependencies Q&A have already
  been updated on this branch (done during the DR phase).
- No external dependencies exist for this implementation — it's purely
  documentation and plugin configuration.
- The proposal-to-plan skill was already updated with external dependencies
  awareness on this branch.

---

**Related Documents:**

- [Proposal](./proposal.md)
- [Design Resolution](./design-resolution.md)
- [Sessions](./sessions/) (created during implementation)
